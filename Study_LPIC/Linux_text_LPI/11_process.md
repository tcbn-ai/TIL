# 11. プロセス管理
## 11.1 プロセスとは
- **プロセス**
    - 実行中のプログラム (アプリケーション) を管理する単位
    - コマンドインタープリタであるシェル自身もプロセスである．

シェルからコマンドを実行した場合を例に，プロセスの親子関係とプロセス生成から消滅までの流れを説明する．

1. ユーザがシェルからコマンドを実行すると，シェルは子プロセスとして自分の分身を作る (これを fork と呼ぶ)．
1. シェルは子プロセスにコマンドの実行 (exec と呼ぶ) を任せ，子プロセスの終了を待つ．
1. 子プロセスはコマンドの実行を終えると，親プロセスに終了を伝え，消滅する．
1. 親プロセスは子プロセスの終了を受け取り，シェルプロンプトを表示し，ユーザの次のコマンドに備える．

<div style="page-break-before:always"></div>

## 11.2 スケジューリング
Linux の特徴: マルチユーザ，マルチタスク
- 1つの CPU でも複数のユーザが同時にログインでき，複数のプロセスを同時に実行できる．
    - 厳密には瞬間瞬間では，プロセスは1つしか実行されず，それぞれのプロセスの実行順序は Linux のスケジューラによって管理されている．

- 各プロセスは Run Queue と呼ばれる待ち行列で待機し，自分が CPU を利用できる順番を待つ．
- 自分の順番が来ると CPU を使用することができ，一定時間 (タイムスライス) だけ処理を前に進める．
- 一定の時間が超過すると，またキューで次の CPU 使用機会を待つことになる (ラウンドロビン方式)．
    - その他に FIFO 方式もある．
- 各プロセスはキューで待機するが，プロセスによっては優先度の高いもの，それほど高くないものがある．
    - e.g. Nice 値
        - -20 から 19 までの値を取る．
        - -20 が最も実行優先度が高く，19 が最も高い
    - nice コマンドにより実行優先度をプロセスに指定できる．
    - renice コマンドにより優先度を変更することができる．


<div style="page-break-before:always"></div>

## 11.3 フォアグラウンドジョブとバックグラウンドジョブ
- ジョブ
    - シェルが管理するプログラムの単位
- c.f. プロセス
    - 実行中のプログラムを管理する単位

シェルからコマンドを実行する場合，ジョブをフォアグラウンドとバックグラウンドに切り替える機能がある．

e.g. 処理に時間のかかるジョブを実行したとき，何もせずジョブの完了を待つのではなく，その間に別の作業をしたり，進捗を確認したい場合．
→ ジョブをバックグラウンドで実行すれば，同じ端末から別のコマンドを実行することができる．

e.g. プログラムの編集作業を中断して，プログラムを試行し，また編集作業に戻る場合．
← 編集を中断した場合，編集の undo や redo が中断前後で継続できる．

- コマンドをバックグラウンドで起動するには，コマンドの後ろに `&` を付けて実行する．
- 実行中のコマンドをバックグラウンドに切り替えるには，ctrl + z でサスペンドしてから，`bg` コマンドでバックグラウンドで実行を継続させる．
    - `fg` コマンドでフォアグラウンドに戻すことも可能．
- ジョブの状態は，`jobs` コマンドで確認することが可能．


実行例:
```
ai@ai-VirtualBox:~$ sleep 3600& <- 1時間スリープする
[1] 1383
ai@ai-VirtualBox:~$ sleep 3601&
[2] 1384
ai@ai-VirtualBox:~$ sleep 3602&
[3] 1385
ai@ai-VirtualBox:~$ jobs
[1]   Running                 sleep 3600 &
[2]-  Running                 sleep 3601 &
[3]+  Running                 sleep 3602 &
ai@ai-VirtualBox:~$ %1  <- [1] のジョブをフォアグラウンドに
sleep 3600
^Z  <- ctrl + z でフォアグラウンドジョブをサスペンドする
[1]+  Stopped                 sleep 3600
ai@ai-VirtualBox:~$ jobs
[1]+  Stopped                 sleep 3600
[2]   Running                 sleep 3601 &
[3]-  Running                 sleep 3602 &
ai@ai-VirtualBox:~$ %-  <- "-" の付いたジョブをフォアグラウンドに
sleep 3602
^C  <- フォアグラウンドにあるジョブを停止
ai@ai-VirtualBox:~$ %%  <- "+" のついたジョブをフォアグラウンドジョブに
sleep 3600
^C  <- フォアグラウンドにあるジョブを停止
ai@ai-VirtualBox:~$ fg  <- この場合，fg は fg %+, %;, %% と同じ動作になる
sleep 3601
^C  <- フォアグラウンドにあるジョブを停止
```

<div style="page-break-before:always"></div>
